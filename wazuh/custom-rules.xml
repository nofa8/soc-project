<group name="soc,api,application">
  <rule id="100002" level="3">
    <decoded_as>json</decoded_as>
    <field name="soc_event">login_success</field>
    <description>Successful API Login</description>
    <options>no_full_log</options>
  </rule>

  <rule id="100003" level="5">
    <decoded_as>json</decoded_as>
    <field name="soc_event">login_failed</field>
    <description>Failed API Login</description>
    <mitre>
      <id>T1110</id>
    </mitre>
  </rule>

  <rule id="100004" level="10" frequency="5" timeframe="60">
    <if_matched_sid>100003</if_matched_sid>
    <description>Brute Force Attack Detected (Multiple Failed Logins)</description>
    <mitre>
      <id>T1110</id>
    </mitre>
  </rule>

  <rule id="100005" level="12">
    <decoded_as>json</decoded_as>
    <field name="soc_event">possible_sqli</field>
    <description>SQL Injection Attempt Detected</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100006" level="7">
    <decoded_as>json</decoded_as>
    <field name="soc_event">http_request</field>
    <field name="status_code">500</field>

    <description>API Internal Error / Anomalous Behavior</description>
    <options>no_full_log</options>
  </rule>

  <!-- Suricata IDS Rules -->
  <rule id="100101" level="5">
    <if_matched_group>suricata</if_matched_group>
    <field name="event_type">^alert$</field>
    <field name="alert.signature_id">1000001</field>
    <description>Suricata: ICMP connection detected</description>
  </rule>

  <rule id="100102" level="14">
    <if_matched_group>suricata</if_matched_group>
    <field name="event_type">^alert$</field>
    <field name="alert.signature_id">1000002</field>
    <description>Suricata: Possible API abuse via HTTP to port 8000 (SID 1000002)</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100103" level="14">
    <if_matched_group>suricata</if_matched_group>
    <field name="event_type">^alert$</field>
    <field name="alert.signature_id">1000003</field>
    <description>Suricata: SQL injection attempt to API (SID 1000003)</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100104" level="14">
    <if_matched_group>suricata</if_matched_group>
    <field name="event_type">^alert$</field>
    <field name="alert.signature_id">1000004</field>
    <description>Suricata: Suspicious User-Agent to API (SID 1000004)</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100105" level="15" timeframe="120">
    <if_matched_group>suricata</if_matched_group>
    <if_matched_sid>100005</if_matched_sid>
    <field name="event_type">alert</field>
    <description>Suricata alert correlated with API internal error (possible exploitation)</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100106" level="10" frequency="5" timeframe="60">
    <if_matched_group>suricata</if_matched_group>
    <field name="event_type">alert</field>
    <description>Multiple Suricata alerts (potential coordinated activity)</description>
  </rule>

  <rule id="100107" level="13" frequency="3" timeframe="120">
    <if_matched_group>suricata</if_matched_group>
    <same_srcip />
    <description>Multiple Suricata alerts from same src IP</description>
  </rule>
</group>