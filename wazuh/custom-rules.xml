<group name="soc,api,application">

  <!-- ============================================ -->
  <!-- APPLICATION LAYER: Authentication & Access  -->
  <!-- ============================================ -->

  <rule id="100010" level="10">
    <decoded_as>json</decoded_as>
    <field name="soc_event">admin_override_access</field>
    <field name="auth_decision">override_granted</field>
    <description>Privilege Escalation: Admin Override Granted</description>
    <mitre><id>T1078</id></mitre>
    <group>auth,privilege_escalation,</group>
  </rule>

  <rule id="100002" level="3">
    <decoded_as>json</decoded_as>
    <field name="soc_event">login_success</field>
    <description>Successful API Login</description>
    <options>no_full_log</options>
    <group>api,authentication,</group>
  </rule>

  <rule id="100003" level="3">
    <decoded_as>json</decoded_as>
    <field name="soc_event">login_failed</field>
    <description>Failed API Login</description>
    <mitre><id>T1110</id></mitre>
    <group>api,authentication_failed,</group>
  </rule>

  <rule id="100004" level="12" frequency="5" timeframe="60">
    <if_matched_sid>100003</if_matched_sid>
    <same_field>src_ip</same_field>
    <description>Brute Force Attack (API) - 5 failures in 60s</description>
    <mitre><id>T1110</id></mitre>
    <group>api,bruteforce,</group>
  </rule>

  <rule id="100005" level="12">
    <decoded_as>json</decoded_as>
    <field name="soc_event">api_request</field>
    <field name="endpoint" type="pcre2">/items</field>
    <field name="raw_parameter" type="pcre2">(?i)(union\s+select|or\s+['"]?1['"]?\s*=\s*['"]?1|--|/\*|\*/)</field>
    <description>SQL Injection Detected in API</description>
    <mitre><id>T1190</id></mitre>
    <group>api,sqli,</group>
  </rule>

  <rule id="100006" level="7">
    <decoded_as>json</decoded_as>
    <field name="soc_event">http_request</field>
    <field name="status_code">500</field>
    <description>API Internal Error / Anomalous Behavior</description>
    <options>no_full_log</options>
    <group>api,anomaly,</group>
  </rule>

  <!-- ============================================ -->
  <!-- VPN LAYER: Remote Access                    -->
  <!-- ============================================ -->

  <rule id="100020" level="4">
    <match>Invalid handshake|peer not found|unauthorized</match>
    <description>VPN Auth Failure (Single)</description>
    <group>vpn,authentication_failed,</group>
  </rule>

  <rule id="100021" level="10" frequency="5" timeframe="60">
    <if_matched_sid>100020</if_matched_sid>
    <same_field>src_ip</same_field>
    <description>VPN Brute Force Attack Detected</description>
    <mitre><id>T1110</id></mitre>
    <group>vpn,bruteforce,</group>
  </rule>

  <!-- ============================================ -->
  <!-- FIREWALL LAYER: Perimeter                   -->
  <!-- ============================================ -->

  <rule id="100030" level="3">
    <if_sid>4100</if_sid>
    <action>FIREWALL-DROP:</action>
    <description>Firewall Packet Drop</description>
    <options>no_full_log</options>
    <group>firewall,blocked,</group>
  </rule>

  <rule id="100031" level="10" frequency="15" timeframe="60">
    <if_matched_sid>100030</if_matched_sid>
    <same_field>src_ip</same_field>
    <description>Port Scan Detected (Firewall Flood)</description>
    <mitre><id>T1046</id></mitre>
    <group>firewall,reconnaissance,</group>
  </rule>

  <!-- ============================================ -->
  <!-- IDS LAYER: Suricata                         -->
  <!-- ============================================ -->

  <rule id="100101" level="5">
    <if_matched_group>suricata</if_matched_group>
    <field name="alert.signature_id">1000001</field>
    <description>Suricata: ICMP Reconnaissance</description>
    <group>suricata,ids,reconnaissance,</group>
  </rule>

  <rule id="100102" level="8">
    <if_matched_group>suricata</if_matched_group>
    <field name="alert.signature_id">1000002</field>
    <description>Suricata: SYN Scan (Potential Nmap)</description>
    <mitre><id>T1595</id></mitre>
    <group>suricata,ids,reconnaissance,</group>
  </rule>

  <rule id="100110" level="12">
    <if_matched_group>suricata</if_matched_group>
    <field name="alert.signature_id">1100001</field>
    <description>Suricata: Suspicious User-Agent (Attacker Tool)</description>
    <mitre><id>T1071</id></mitre>
    <group>suricata,ids,web_attack,</group>
  </rule>

</group>